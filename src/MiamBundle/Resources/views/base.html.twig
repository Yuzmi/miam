<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>{% block head_title %}Miam{% endblock %}</title>
		<link rel="icon" href="{{ asset('favicon.ico') }}" />
		
		{% stylesheets "@MiamBundle/Resources/public/css/*.css" %}
			<link href="{{ asset_url }}" type="text/css" rel="stylesheet">
		{% endstylesheets %}

		{% block stylesheets %}
			{% stylesheets "@MiamBundle/Resources/public/scss/main.scss" filter='scss' output='css/main.css' %}
				<link href="{{ asset_url }}" type="text/css" rel="stylesheet">
			{% endstylesheets %}
		{% endblock %}
	</head>
	<body>
		<noscript>Y U DO THAT TO ME !? PLEASE DISABLE NOSCRIPT ! :-(</noscript>

		{% block body %}{% endblock %}
		
		<div class="flashMessages">
			{% for fm in app.session.flashbag.get('success') %}
				<div class="flashMessageContainer">
					<div class="flashMessage success">{{ fm }}</div>
				</div>
			{% endfor %}

			{% for fm in app.session.flashbag.get('notice') %}
				<div class="flashMessageContainer">
					<div class="flashMessage notice">{{ fm }}</div>
				</div>
			{% endfor %}
			
			{% for fm in app.session.flashbag.get('error') %}
				<div class="flashMessageContainer">
					<div class="flashMessage error">{{ fm }}</div>
				</div>
			{% endfor %}
		</div>

		{% if not app.user %}
			<div class="popupContainer login">
				<div class="popup login">
					<div class="header">Login</div>

					<form method="POST" action="{{ path('login_check') }}">
					    <label for="username">Username:</label>
					    <input type="text" id="username" name="_username" placeholder="Username">

					    <br>

					    <label for="password">Password:</label>
					    <input type="password" id="password" name="_password" placeholder="Password">

					    <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

					    <br>

					    <button type="submit">Login</button>
					</form>
				</div>
			</div>

			<div class="popupContainer register">
				<div class="popup">
					<div class="header">Register</div>

					<form method="POST" action="{{ path('register_check') }}">
						<label for="username">Choose a username:</label>
						<input type="text" id="username" name="username" placeholder="Username">

						<br>

						<label for="password">Choose a password:</label>
						<input type="text" id="password" name="password" placeholder="Password">

						<br>

						<label for="password_again">Retype the password:</label>
						<input type="text" id="password_again" name="password_again" placeholder="Password (again)">

						<input type="hidden" name="csrf_token" value="{{ csrf_token('register') }}">

						<br>

						<button type="submit">Register</button>
					</form>
				</div>
			</div>
		{% endif %}

		{% block javascripts %}
			{% javascripts
				"@MiamBundle/Resources/public/js/jquery.js"
				"@MiamBundle/Resources/public/js/main.js"
				"@MiamBundle/Resources/public/js/items.js"
			%}
				<script src="{{ asset_url }}"></script>
			{% endjavascripts %}

			<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
			<script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>

			<script>
				app.preInit = function() {
					app.dateLoaded = '{{ "now"|date() }}';

					{% if app.user %}
						app.user = { 'id': {{ app.user.id }} };
					{% else %}
						app.user = false;
					{% endif %}
				}
			</script>
		{% endblock %}
	</body>
</html>